@using BsBios.Portal.Common
@using BsBios.Portal.UI.Helpers
@using BsBios.Portal.ViewModel
@model ProcessoCotacaoMaterialCadastroVm

@{
    ViewBag.TituloDaPagina = "Processo de Cotação de Material";
}
<link href="@Url.Content("~/Content/kendo/2012.3.1114/kendo.common.min.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/kendo/2012.3.1114/kendo.default.min.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/jquery.loadmask.css")" rel="stylesheet" />

<div class="paginaCadastro">
    @using (Html.BeginForm("AtualizarProcesso", "ProcessoDeCotacaoService"))
    {

        <fieldset>
            <legend>Requisição de Compra</legend>

            @Html.HiddenFor(model => model.Id)
            @Html.HiddenFor(model => model.CodigoMaterial)
            
            @if (Model != null && Model.RequisicaoDeCompraVm != null)
            {
                @Html.Partial("_RequisicaoDeCompra", Model.RequisicaoDeCompraVm)
            }
        </fieldset>
        <fieldset>
            <legend>Processo de Cotação</legend>
            <div class="coluna">
                @Html.Label("Status:",new{@class="labelNaLinha"})
                <span id="spanStatus">@(Model != null ? Model.DescricaoStatus : "Não Iniciado")</span> 
            </div>
            @Html.LinhaComDuasColunas(new ColunaComTextBox<ProcessoCotacaoMaterialCadastroVm, string>(x => x.DataLimiteRetorno,"campoDatePicker maskdata"),
            new ColunaComTextArea<ProcessoCotacaoMaterialCadastroVm, string>(x => x.Requisitos))
            <div class="error"></div>
            <div class="divBotao">
                <input type="button" id="btnSalvarProcesso" value="Salvar" class="blue" />
            </div>
        </fieldset>
    }

    @Html.Partial("_ProcessoDeCotacaoOperacoes", new ViewDataDictionary() 
        {   new KeyValuePair<string, object>("idProcessoCotacao", Model != null ? Model.Id : 0),
            new KeyValuePair<string, object>("TipoDeCotacao", Enumeradores.TipoDeCotacao.Material),
            new KeyValuePair<string, object>("UrlEnviarEmail", Url.Action("EnviarEmailDeAbertura","ProcessoDeCotacaoDeMaterialEmail"))
        })

</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="@Url.Content("~/Scripts/kendo/2012.3.1114/kendo.web.min.js")"></script>
    <script src="@Url.Content("~/Scripts/kendo/2012.3.1114/kendo.grid.min.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery.maskedinput.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery.meio.mask.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Scripts/jquery.loadmask.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Scripts/ProcessoDeCotacao/CotacaoDoFornecedorResumido.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Scripts/ProcessoDeCotacao/ProcessoDeCotacaoOperacoes.js")"></script>
    <script type="text/javascript">
        $(function() {
            aplicaMascaraData();
            var idProcessoCotacao = '@(Model != null ? Model.Id : 0)';
            GridCotacaoResumida.Configurar(idProcessoCotacao);
            ProcessoDeCotacaoOperacoes.Configurar('@((int) Enumeradores.TipoDeCotacao.Material)');

            $('#btnSalvar').click(function () {
                $('.error').empty();
                var form = $('form');
                if (!$(form).validate().form()) {
                    return;
                }

                var formData = $(form).serialize();
                $.post('@Url.Action("AtualizarProcesso","ProcessoDeCotacaoService" )', formData,
                    function (data) {
                        if (data.Sucesso) {
                            location.href = '@Url.Action("Index","ProcessoDeCotacaoDeMaterial")';
                        } else {
                            atualizaMensagemDeErro(data.Mensagem);
                        }
                    });
            });

        })
    </script>
}
