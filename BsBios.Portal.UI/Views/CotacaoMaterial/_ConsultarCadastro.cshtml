@using BsBios.Portal.UI.Helpers
@using BsBios.Portal.ViewModel
@model CotacaoMaterialConsultarCadastroVm

@{
    ViewBag.TituloDaPagina = "Cotação de Material";
    Layout = null;
}
<div class="paginaCadastro">
    <fieldset>
        <legend>Informações Gerais</legend>

        @Html.HiddenFor(model => model.IdProcessoCotacao)
        @Html.HiddenFor(model => model.CodigoFornecedor)
        @Html.HiddenFor(model => model.IdCotacao)
            
        @Html.LinhaComDuasColunas(new ColunaComLabel<CotacaoMaterialConsultarCadastroVm, string>(x => x.Incoterm)
                                  , new ColunaComLabel<CotacaoMaterialConsultarCadastroVm, string>(x => x.DescricaoIncoterm))
            
        @Html.LinhaComDuasColunas(new ColunaComLabel<CotacaoMaterialConsultarCadastroVm, string>(x => x.CondicaoPagamento)
                                  , new ColunaComLabel<CotacaoMaterialConsultarCadastroVm, string>(x => x.TipoDeFrete))
            
    </fieldset>

    <fieldset id="fieldSetItens">
        <legend>Itens</legend>
        <div id="divGridItensVisualizar" class="divGrid"></div>
    </fieldset>
    <div id="divCotacaoItem" class="janelaModal"></div>
</div>
<script type="text/javascript">
    $(function () {
        var idCotacao = $('#IdCotacao').val();
        ProcessoDeCotacaoItensGrid.configurar({
            schemaData: 'Registros',
            transportUrl: UrlPadrao.ListarItensDoProcessoDeCotacao + '/?idProcessoCotacao=' + $('#IdProcessoCotacao').val(),
            renderTo: '#divGridItensVisualizar',
            exibirBotaoVisualizar: (idCotacao > 0),
            pageable: false
        });

        $('#divGridItensVisualizar').find('.button_visualize').die("click");
        $('#divGridItensVisualizar').find('.button_visualize').live("click", function () {
                
            var grid = $('#divGridItensVisualizar').data("kendoGrid");
            var dataItem = grid.dataItem(grid.select());
            $('#divCotacaoItem').load('@Url.Action("EditarCadastro", "CotacaoMaterialItem")' 
                + "/?idProcessoCotacao=" + $('#IdProcessoCotacao').val()
                + "&codigoDoFornecedor=" + $('#CodigoFornecedor').val()
                + "&numeroDaRequisicao=" + dataItem.NumeroRequisicao
                + "&numeroDoItemDaRequisicao=" + dataItem.NumeroItem,
                function () {
                    aplicaMascaraMoeda('#divCotacaoItem');
                    aplicaMascaraQuantidade('#divCotacaoItem');
                    aplicaMascaraData('#divCotacaoItem');
                    $('#divCotacaoItem').dialog('open');
                }
            );
        });
            
        $('#divCotacaoItem').customDialog({
            title: 'Cotação do Item'
        });

    });
</script>


